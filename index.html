<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>WCAG 2.2 ‚Äì Interaktive Checkliste (mit Rollen-Views)</title>
<style>
  :root{
    --bg:#0b1020; --panel:#121833; --muted:#aab3d8; --text:#eef2ff; --accent:#7dd3fc;
    --ok:#22c55e; --warn:#f59e0b; --bad:#ef4444; --focus:#93c5fd; --chip:#1f2a52;
    --border:#253060; --kbd:#0f172a;
  }
  html,body{background:var(--bg);color:var(--text);font:16px system-ui,Segoe UI,Roboto,Arial,sans-serif;line-height:1.45;margin:0}
  header,footer{padding:16px 24px;background:linear-gradient(180deg,var(--panel),transparent)}
  header h1{font-size:1.25rem;margin:.25rem 0}
  header small{color:var(--muted)}
  a{color:var(--accent)}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}
  .controls{display:grid;gap:12px;grid-template-columns:1fr}
  @media (min-width:980px){.controls{grid-template-columns:2fr 1.3fr 1fr 1fr 1fr}}
  .box{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:10px}
  input[type="text"],select,button, .pill{background:#0c1230;border:1px solid var(--border);color:var(--text);border-radius:10px;padding:10px 12px}
  input[type="text"]{width:100%}
  button{cursor:pointer}
  button.primary{background:#11316a;border-color:#2b5fcb}
  kbd{background:var(--kbd);padding:2px 6px;border-radius:6px;border:1px solid #29334e}
  .pill{display:inline-flex;gap:8px;align-items:center}
  .chips{display:flex;flex-wrap:wrap;gap:6px}
  .chip{background:var(--chip);color:var(--muted);border:1px solid var(--border);border-radius:999px;padding:2px 8px;font-size:.82rem}
  .list{display:grid;gap:10px}
  .item{background:#0d1533;border:1px solid var(--border);border-radius:12px;padding:10px;display:grid;grid-template-columns:auto 1fr auto;gap:10px}
  .title{font-weight:700}
  .meta{color:var(--muted);font-size:.9rem;display:flex;flex-wrap:wrap;gap:6px;align-items:center}
  .cnt{display:flex;gap:8px;align-items:center}
  .cnt input[type="checkbox"]{width:22px;height:22px}
  details{grid-column:1/-1;background:#0b1433;border-radius:8px;border:1px dashed #2a376b;padding:8px}
  summary{cursor:pointer;font-weight:600}
  .bar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin:6px 0 12px}
  .progress{height:10px;background:#091027;border:1px solid var(--border);border-radius:999px;overflow:hidden}
  .progress > span{display:block;height:100%;background:linear-gradient(90deg,#22c55e,#60a5fa)}
  .right{display:flex;gap:8px;align-items:center}
  .tag{font-weight:700;padding:2px 6px;border-radius:6px;border:1px solid var(--border)}
  .A{background:#0c2a1a;color:#8dffb8}
  .AA{background:#1f224b;color:#9dc1ff}
  .AAA{background:#3a1031;color:#ffb1e5}
  .P1{background:#1c284a;color:#cde1ff}.P2{background:#2a274a;color:#d5c9ff}
  .P3{background:#2a3c2e;color:#c7f9d2}.P4{background:#3e2a2a;color:#ffd4c4}
  .RUX{background:#12331b;color:#b7ffd5}.RUI{background:#182a4e;color:#cfe1ff}
  .RContent{background:#3a2a18;color:#ffe3b7}.RDev{background:#3a182c;color:#ffb7df}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap}
  .roles{display:flex;flex-wrap:wrap;gap:8px}
  .rolebtn{border-radius:999px;padding:6px 10px;border:1px solid var(--border);background:#0c1230}
  .rolebtn[aria-pressed="true"]{outline:2px solid var(--focus)}
  .preset{font-size:.85rem}
  .sr-only{position:absolute!important;clip:rect(1px,1px,1px,1px);padding:0;border:0;height:1px;width:1px;overflow:hidden;white-space:nowrap}
  .note{color:#a9b6e6;font-size:.9rem}
  .hidden{display:none!important}
</style>
</head>
<body>
<header class="wrap" role="banner">
  <h1>WCAG 2.2 ‚Äì Interaktive Checkliste (A + AA, optional AAA) ‚Äì mit Rollen-Filter</h1>
  <div class="note">Quelle: <a href="https://www.w3.org/TR/WCAG22/" target="_blank" rel="noreferrer noopener">W3C WCAG 2.2</a>. Fortschritt, Notizen, Filter werden lokal gespeichert.</div>
</header>

<main class="wrap" role="main">
  <section class="box" aria-labelledby="controls">
    <h2 id="controls" class="sr-only">Steuerung</h2>
    <div class="controls">
      <label class="pill" aria-label="Projektname">
        <span>üìÅ Projekt</span>
        <input id="project" type="text" placeholder="z. B. Shop Redesign Q4" aria-describedby="savehint"/>
      </label>
      <label class="pill">
        <span>üîé Suche</span>
        <input id="q" type="text" placeholder="Suche nach ID, Titel, Stichwort (z. B. Fokus, Formular)‚Ä¶" />
      </label>
      <label class="pill">
        <span>üéØ Level</span>
        <select id="level">
          <option value="ALL">Alle</option>
          <option value="A">A</option>
          <option value="AA" selected>AA (empfohlen)</option>
          <option value="AAA">AAA</option>
        </select>
      </label>
      <label class="pill">
        <span>üß≠ Prinzip</span>
        <select id="principle">
          <option value="ALL">Alle</option>
          <option value="1">1 Wahrnehmbar</option>
          <option value="2">2 Bedienbar</option>
          <option value="3">3 Verst√§ndlich</option>
          <option value="4">4 Robust</option>
        </select>
      </label>
      <div class="toolbar">
        <button id="toggleAAA" class="pill" aria-pressed="false" title="AAA anzeigen/ausblenden" type="button">AAA ein/aus</button>
        <button id="onlyOpen" class="pill" type="button">Nur offene Punkte</button>
        <button id="expandAll" class="pill" type="button">Alle Details auf/zu</button>
        <button id="export" class="pill" type="button">Export JSON</button>
        <input id="importFile" class="hidden" type="file" accept="application/json" />
        <button id="import" class="pill" type="button">Import JSON</button>
        <button id="print" class="pill" type="button">Drucken / PDF</button>
      </div>
      <div class="box" style="grid-column:1/-1">
        <div class="roles" aria-label="Rollenfilter">
          <button class="rolebtn" data-role="UX" aria-pressed="true" type="button">UX</button>
          <button class="rolebtn" data-role="UI" aria-pressed="true" type="button">UI</button>
          <button class="rolebtn" data-role="Content" aria-pressed="true" type="button">Content</button>
          <button class="rolebtn" data-role="Dev" aria-pressed="true" type="button">Dev</button>
          <span class="note" style="margin-left:8px">‚Ä¢ Tippe auf Rollen, um (de-)zu aktivieren</span>
        </div>
        <div class="toolbar" style="margin-top:8px">
          <button class="preset pill" data-preset="UX" type="button">Nur UX</button>
          <button class="preset pill" data-preset="UI" type="button">Nur UI</button>
          <button class="preset pill" data-preset="Content" type="button">Nur Content</button>
          <button class="preset pill" data-preset="Dev" type="button">Nur Dev</button>
          <button class="preset pill" data-preset="ALL" type="button">Alle Rollen</button>
        </div>
      </div>
      <div id="savehint" class="note">Speichert automatisch (localStorage). Shortcuts: <kbd>f</kbd>/<kbd>/</kbd> Suche, <kbd>p</kbd> Drucken.</div>
    </div>

    <div class="bar">
      <div id="counts" aria-live="polite"></div>
      <div class="progress" aria-label="Fortschritt">
        <span id="prog" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" style="width:0%"></span>
      </div>
    </div>
  </section>

  <section aria-labelledby="listhead">
    <h2 id="listhead" class="sr-only">Checklistenpunkte</h2>
    <div id="list" class="list" role="list"></div>
  </section>
</main>

<footer class="wrap" role="contentinfo">
  <div class="chips">
    <span class="chip">Neu in 2.2: 2.4.11, 2.4.12, 2.4.13, 2.5.7, 2.5.8, 3.2.6, 3.3.7, 3.3.8, 3.3.9</span>
    <span class="chip">Entfallen: 4.1.1 Parsing</span>
    <span class="chip">Quick-Ref: <a href="https://www.w3.org/WAI/WCAG22/quickref/" target="_blank" rel="noreferrer noopener">How to Meet (WAI)</a></span>
  </div>
</footer>

<script>
/* ---------------- WCAG 2.2 Daten mit Rollen (UX, UI, Content, Dev) ---------------- */
const SC = [
  // Prinzip 1 ‚Äì Wahrnehmbar
  {id:"1.1.1", lvl:"A", p:1, t:"Nicht-Text-Inhalte", ux:"Alt-Texte, dekorative Markierung.", roles:["UX","UI","Content","Dev"]},
  {id:"1.2.1", lvl:"A", p:1, t:"Nur-Audio / Nur-Video (vorauf.)", ux:"Transkript/Alternative.", roles:["Content","UX","Dev"]},
  {id:"1.2.2", lvl:"A", p:1, t:"Untertitel (vorauf.)", ux:"Untertitel vorhanden.", roles:["Content","UX","Dev"]},
  {id:"1.2.3", lvl:"A", p:1, t:"Audiodeskription/Alternative (vorauf.)", ux:"AD oder Textalternative.", roles:["Content","UX"]},
  {id:"1.2.4", lvl:"AA", p:1, t:"Untertitel (live)", ux:"Live-UT falls Live-Video.", roles:["Content","Dev"]},
  {id:"1.2.5", lvl:"AA", p:1, t:"Audiodeskription (vorauf.)", ux:"AD f√ºr Videos.", roles:["Content","UX"]},
  {id:"1.3.1", lvl:"A", p:1, t:"Infos & Beziehungen", ux:"Semantik/Struktur korrekt.", roles:["UX","UI","Dev"]},
  {id:"1.3.2", lvl:"A", p:1, t:"Bedeutungsreihenfolge", ux:"Lesereihenfolge = visuell.", roles:["UX","UI","Dev"]},
  {id:"1.3.3", lvl:"A", p:1, t:"Sinnesmerkmale", ux:"Nicht nur Farbe/Form/Position.", roles:["UX","UI","Content"]},
  {id:"1.3.4", lvl:"AA", p:1, t:"Ausrichtung", ux:"Hoch-/Querformat nutzbar.", roles:["UX","UI","Dev"]},
  {id:"1.3.5", lvl:"AA", p:1, t:"Eingabezweck erkennen", ux:"HTML autocomplete usw.", roles:["UX","Dev"]},
  {id:"1.4.1", lvl:"A", p:1, t:"Farbe nicht allein", ux:"Zus√§tzliche Kennzeichnung.", roles:["UX","UI","Content"]},
  {id:"1.4.2", lvl:"A", p:1, t:"Audiosteuerung", ux:"Autoplay stoppbar.", roles:["UX","Dev"]},
  {id:"1.4.3", lvl:"AA", p:1, t:"Kontrast (Minimum)", ux:"Text ‚â• 4.5:1 (gro√ü 3:1).", roles:["UI","UX"]},
  {id:"1.4.4", lvl:"AA", p:1, t:"Textgr√∂√üe anpassen", ux:"Bis 200 % ohne Verlust.", roles:["UI","Dev","UX"]},
  {id:"1.4.5", lvl:"AA", p:1, t:"Textbilder", ux:"Keine Bilder von Text.", roles:["UI","Content","UX"]},
  {id:"1.4.10", lvl:"AA", p:1, t:"Umfluss (Reflow)", ux:"Bis 320 px Breite.", roles:["UI","Dev","UX"]},
  {id:"1.4.11", lvl:"AA", p:1, t:"Nicht-Text-Kontrast", ux:"UI-Konturen ‚â• 3:1.", roles:["UI","UX"]},
  {id:"1.4.12", lvl:"AA", p:1, t:"Textabstand", ux:"Zeilen/Absatz-Abst√§nde.", roles:["UI","UX","Dev"]},
  {id:"1.4.13", lvl:"AA", p:1, t:"Hover/Fokus-Inhalt", ux:"Overlays bedienbar.", roles:["UX","UI","Dev"]},

  // Prinzip 2 ‚Äì Bedienbar
  {id:"2.1.1", lvl:"A", p:2, t:"Tastatur", ux:"Alles per Tastatur.", roles:["Dev","UX","UI"]},
  {id:"2.1.2", lvl:"A", p:2, t:"Kein Tastaturfang", ux:"Fokus nicht gefangen.", roles:["Dev","UX"]},
  {id:"2.1.4", lvl:"A", p:2, t:"Zeichen-Tastenk√ºrzel", ux:"Ein-Tasten-Shortcuts absicherbar.", roles:["Dev","UX"]},
  {id:"2.2.1", lvl:"A", p:2, t:"Zeit anpassbar", ux:"Timer verl√§ngerbar.", roles:["UX","Dev"]},
  {id:"2.2.2", lvl:"A", p:2, t:"Anhalten/Stoppen/Verbergen", ux:"Bewegtes stoppbar.", roles:["UX","UI","Dev"]},
  {id:"2.3.1", lvl:"A", p:2, t:"Drei Blitze oder darunter", ux:"Keine gef√§hrdenden Blitze.", roles:["UI","Dev"]},
  {id:"2.4.1", lvl:"A", p:2, t:"Bl√∂cke √ºberspringen", ux:"Skip-Links/Landmarks.", roles:["Dev","UX"]},
  {id:"2.4.2", lvl:"A", p:2, t:"Seitentitel", ux:"Eindeutig & pr√§zise.", roles:["Content","UX"]},
  {id:"2.4.3", lvl:"A", p:2, t:"Fokusreihenfolge", ux:"Sinnvolle Reihenfolge.", roles:["Dev","UX"]},
  {id:"2.4.4", lvl:"A", p:2, t:"Linkzweck (im Kontext)", ux:"Linktexte verst√§ndlich.", roles:["Content","UX"]},
  {id:"2.4.5", lvl:"AA", p:2, t:"Mehrere Wege", ux:"Suche/Sitemap etc.", roles:["UX","Dev","Content"]},
  {id:"2.4.6", lvl:"AA", p:2, t:"√úberschriften/Bezeichnungen", ux:"Beschreiben Zweck.", roles:["Content","UX","UI"]},
  {id:"2.4.7", lvl:"AA", p:2, t:"Fokus sichtbar", ux:"Fokus klar sichtbar.", roles:["UI","Dev","UX"]},
  {id:"2.4.11", lvl:"AA", p:2, t:"Fokus nicht verdeckt (Minimum) ‚Ä¢ Neu", ux:"Nicht vollst√§ndig verdeckt.", roles:["UI","Dev","UX"]},
  {id:"2.4.12", lvl:"AAA", p:2, t:"Fokus nicht verdeckt (Erweitert) ‚Ä¢ Neu", ux:"Vollst√§ndig sichtbar.", roles:["UI","Dev"]},
  {id:"2.4.13", lvl:"AAA", p:2, t:"Fokus-Erscheinung ‚Ä¢ Neu", ux:"Gr√∂√üe & Kontrast ‚â• 3:1.", roles:["UI","UX"]},
  {id:"2.5.1", lvl:"A", p:2, t:"Pointer-Gesten", ux:"Alternative zu Mehrfinger.", roles:["UX","Dev","UI"]},
  {id:"2.5.2", lvl:"A", p:2, t:"Pointer-Abbruch", ux:"Nicht bei ‚Äödown‚Äò ausl√∂sen.", roles:["Dev","UX"]},
  {id:"2.5.3", lvl:"A", p:2, t:"Label im Namen", ux:"Visueller Name im a11y-Namen.", roles:["UI","Dev","Content","UX"]},
  {id:"2.5.4", lvl:"A", p:2, t:"Bewegungsaktivierung", ux:"Optional/deaktivierbar.", roles:["Dev","UX"]},
  {id:"2.5.7", lvl:"AA", p:2, t:"Ziehen-Bewegungen ‚Ä¢ Neu", ux:"Einfache Alternative zu Drag.", roles:["UX","Dev","UI"]},
  {id:"2.5.8", lvl:"AA", p:2, t:"Zielgr√∂√üe (Minimum) ‚Ä¢ Neu", ux:"‚â• 24√ó24 CSS-px o. Abstand.", roles:["UI","UX","Dev"]},

  // Prinzip 3 ‚Äì Verst√§ndlich
  {id:"3.1.1", lvl:"A", p:3, t:"Sprache der Seite", ux:"lang korrekt.", roles:["Dev","Content"]},
  {id:"3.1.2", lvl:"AA", p:3, t:"Sprache von Teilen", ux:"Passagen ausgezeichnet.", roles:["Content","Dev"]},
  {id:"3.2.1", lvl:"A", p:3, t:"Bei Fokus", ux:"Keine Kontext√§nderung.", roles:["UX","Dev"]},
  {id:"3.2.2", lvl:"A", p:3, t:"Bei Eingabe", ux:"Eingabe √§ndert Kontext nicht.", roles:["UX","Dev"]},
  {id:"3.2.3", lvl:"AA", p:3, t:"Konsistente Navigation", ux:"Reihenfolge/Platz gleich.", roles:["UX","UI","Dev"]},
  {id:"3.2.4", lvl:"AA", p:3, t:"Konsistente Identifizierung", ux:"Gleiche Komp. gleich benannt.", roles:["UX","UI","Content"]},
  {id:"3.2.6", lvl:"A", p:3, t:"Konsistente Hilfe ‚Ä¢ Neu", ux:"Hilfe-Mechanismen am selben Ort.", roles:["UX","UI","Dev","Content"]},
  {id:"3.3.1", lvl:"A", p:3, t:"Fehleridentifikation", ux:"Fehler klar & referenziert.", roles:["UX","Dev","UI","Content"]},
  {id:"3.3.2", lvl:"A", p:3, t:"Beschriftungen/Anweisungen", ux:"Labels/Instruktionen.", roles:["Content","UX","UI","Dev"]},
  {id:"3.3.3", lvl:"AA", p:3, t:"Fehlervorschlag", ux:"Konkrete Hilfe bei Fehlern.", roles:["UX","Content","Dev"]},
  {id:"3.3.4", lvl:"AA", p:3, t:"Fehlervermeidung (rechtl./fin./Daten)", ux:"Best√§tigen/pr√ºfen/√§ndern.", roles:["UX","Dev"]},
  {id:"3.3.7", lvl:"A", p:3, t:"Doppelteingaben ‚Ä¢ Neu", ux:"Daten wiederverwenden.", roles:["UX","Dev"]},
  {id:"3.3.8", lvl:"AA", p:3, t:"Zug√§ngliche Authentifizierung (Minimum) ‚Ä¢ Neu", ux:"Keine reinen Ged√§chtnistests.", roles:["UX","Dev","UI"]},
  {id:"3.3.9", lvl:"AAA", p:3, t:"Zug√§ngliche Authentifizierung (Erweitert) ‚Ä¢ Neu", ux:"Auch keine Code-Transkription.", roles:["UX","Dev","UI"]},

  // Prinzip 4 ‚Äì Robust
  {id:"4.1.2", lvl:"A", p:4, t:"Name, Rolle, Wert", ux:"a11y-APIs korrekt.", roles:["Dev","UI"]},
  {id:"4.1.3", lvl:"AA", p:4, t:"Statusmeldungen", ux:"Programmatisch erkennbar.", roles:["Dev","UX","Content"]}
];

/* ---------------- Helpers/State ---------------- */
const el = s=>document.querySelector(s);
const list = el('#list');
const state = JSON.parse(localStorage.getItem('wcag22_state_roles')||'{}');
const projectEl = el('#project'); projectEl.value = state.project||'';
const activeRoles = new Set(state.roles||["UX","UI","Content","Dev"]);

function save(){
  const data = {
    project: projectEl.value,
    done: getDone(),
    notes: getNotes(),
    showAAA: el('#toggleAAA').getAttribute('aria-pressed')==='true',
    roles: Array.from(activeRoles)
  };
  localStorage.setItem('wcag22_state_roles', JSON.stringify(data));
}

function getDone(){
  return Array.from(document.querySelectorAll('.item input[type=checkbox]'))
    .reduce((m,cb)=>{m[cb.dataset.id]=cb.checked;return m;}, {});
}
function getNotes(){
  return Array.from(document.querySelectorAll('.item [data-note]'))
    .reduce((m,inp)=>{m[inp.dataset.note]=inp.value;return m;}, {});
}

/* ---------------- Render ---------------- */
function render(){
  const q = el('#q').value.toLowerCase().trim();
  const lvl = el('#level').value;
  const princ = el('#principle').value;
  const showAAA = el('#toggleAAA').getAttribute('aria-pressed')==='true';

  list.innerHTML='';
  const done = (state.done||{});
  const notes = (state.notes||{});
  let shown=0, checked=0;

  SC.filter(s=>{
    if(!showAAA && s.lvl==='AAA') return false;
    if(lvl!=='ALL' && s.lvl!==lvl) return false;
    if(princ!=='ALL' && String(s.p)!==princ) return false;
    if(activeRoles.size && !s.roles.some(r=>activeRoles.has(r))) return false;
    if(!q) return true;
    return (s.id+s.t+s.ux+s.roles.join(',')).toLowerCase().includes(q);
  }).forEach(s=>{
    shown++;
    const isDone = !!done[s.id];
    if(isDone) checked++;

    const item = document.createElement('div');
    item.className='item';
    item.setAttribute('role','listitem');
    const roleBadges = s.roles.map(r=>{
      const cls = r==="UX"?"RUX":r==="UI"?"RUI":r==="Content"?"RContent":"RDev";
      return `<span class="tag ${cls}">${r}</span>`;
    }).join(' ');

    item.innerHTML=`
      <div class="cnt">
        <input type="checkbox" id="cb-${s.id}" data-id="${s.id}" ${isDone?'checked':''} />
      </div>
      <div>
        <div class="title">${s.id} ‚Äì ${s.t}</div>
        <div class="meta">
          <span class="tag ${s.lvl}">${s.lvl}</span>
          <span class="tag P${s.p}">P${s.p}</span>
          ${roleBadges}
          <span class="note">UX-Check: ${s.ux}</span>
        </div>
        <details>
          <summary>Details & Links</summary>
          <div class="note">Offiziell: <a target="_blank" rel="noreferrer noopener" href="https://www.w3.org/TR/WCAG22/#${s.id.replace(/\./g,'-')}">WCAG 2.2 ¬ß${s.id}</a> ¬∑ Quick-Ref: <a target="_blank" rel="noreferrer noopener" href="https://www.w3.org/WAI/WCAG22/quickref/?versions=2.2#${s.id.replace(/\./g,'-')}">How to Meet</a></div>
          <label class="pill" style="margin-top:8px;display:inline-flex;gap:8px;align-items:center">
            <span>üìù Notiz</span>
            <input type="text" placeholder="Projekt-Notiz zu ${s.id} ‚Ä¶" data-note="${s.id}" />
          </label>
        </details>
      </div>
      <div class="right">
        <button class="pill" data-act="open" aria-label="WCAG 2.2 √∂ffnen" type="button">üìñ</button>
      </div>
    `;
    const cb = item.querySelector('input[type=checkbox]');
    cb.addEventListener('change', ()=>{ state.done=Object.assign({},state.done,{[s.id]:cb.checked}); save(); updateProgress(); });
    const nt = item.querySelector('[data-note]'); nt.value = (notes[s.id]||''); nt.addEventListener('input', ()=>{ state.notes=Object.assign({},state.notes,{[s.id]:nt.value}); save(); });
    item.querySelector('[data-act=open]').addEventListener('click', ()=> window.open(`https://www.w3.org/TR/WCAG22/#${s.id.replace(/\./g,'-')}`,'_blank'));
    list.appendChild(item);
  });

  el('#counts').textContent = `Angezeigt: ${shown} ‚Ä¢ Abgehakt: ${checked} ‚Ä¢ Rollen: ${Array.from(activeRoles).join(', ')||'‚Äì'}`;
  const pct = shown? Math.round(checked*100/shown):0;
  el('#prog').style.width = pct+'%';
  el('#prog').setAttribute('aria-valuenow', pct);
}

function updateProgress(){
  const shown = document.querySelectorAll('.item').length;
  const checked = Array.from(document.querySelectorAll('.item input[type=checkbox]:checked')).length;
  el('#counts').textContent = `Angezeigt: ${shown} ‚Ä¢ Abgehakt: ${checked} ‚Ä¢ Rollen: ${Array.from(activeRoles).join(', ')||'‚Äì'}`;
  const pct = shown? Math.round(checked*100/shown):0;
  el('#prog').style.width = pct+'%';
  el('#prog').setAttribute('aria-valuenow', pct);
}

/* ---------------- UI Events ---------------- */
el('#q').addEventListener('input', render);
el('#level').addEventListener('change', render);
el('#principle').addEventListener('change', render);
el('#toggleAAA').addEventListener('click', e=>{
  const cur = e.currentTarget.getAttribute('aria-pressed')==='true';
  e.currentTarget.setAttribute('aria-pressed', String(!cur));
  save(); render();
});
el('#onlyOpen').addEventListener('click', ()=>{
  const done = getDone();
  document.querySelectorAll('.item').forEach(it=>{
    const id = it.querySelector('input').dataset.id;
    it.style.display = done[id] ? 'none' : '';
  });
  updateProgress();
});
el('#expandAll').addEventListener('click', ()=>{
  const all = Array.from(document.querySelectorAll('details'));
  const opened = all.some(d=>!d.open);
  all.forEach(d=>d.open = opened);
});
el('#export').addEventListener('click', ()=>{
  const blob = new Blob([JSON.stringify(JSON.parse(localStorage.getItem('wcag22_state_roles')||'{}'),null,2)],{type:'application/json'});
  const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='wcag22-checklist-export.json'; a.click();
});
el('#import').addEventListener('click', ()=> el('#importFile').click());
el('#importFile').addEventListener('change', async e=>{
  const f = e.target.files[0]; if(!f) return;
  const txt = await f.text();
  try{
    const data = JSON.parse(txt);
    localStorage.setItem('wcag22_state_roles', txt);
    Object.assign(state, data);
    projectEl.value=state.project||'';
    // Restore role toggles
    setAllRoleButtons(false);
    (state.roles||["UX","UI","Content","Dev"]).forEach(r=>toggleRole(r,true,false));
    render();
  }catch(err){ alert('Ung√ºltige JSON-Datei.'); }
});
el('#print').addEventListener('click', ()=> window.print());
projectEl.addEventListener('input', save);
document.addEventListener('keydown', (e)=>{ if(e.key==='/'||e.key==='f'){ el('#q').focus(); e.preventDefault(); } if(e.key==='p'){ window.print(); e.preventDefault(); }});

/* ---- Rollensteuerung ---- */
const roleButtons = Array.from(document.querySelectorAll('.rolebtn'));
roleButtons.forEach(btn=>{
  const role = btn.dataset.role;
  btn.setAttribute('aria-pressed', activeRoles.has(role) ? 'true' : 'false');
  btn.addEventListener('click', ()=>{
    const next = !(btn.getAttribute('aria-pressed')==='true');
    toggleRole(role, next, true);
  });
});

function toggleRole(role, enable, rerender=true){
  const btn = roleButtons.find(b=>b.dataset.role===role);
  if(enable){ activeRoles.add(role); btn?.setAttribute('aria-pressed','true'); }
  else{ activeRoles.delete(role); btn?.setAttribute('aria-pressed','false'); }
  save(); if(rerender) render();
}
function setAllRoleButtons(enabled){
  roleButtons.forEach(b=>b.setAttribute('aria-pressed', enabled?'true':'false'));
  if(enabled){ ["UX","UI","Content","Dev"].forEach(r=>activeRoles.add(r)); }
  else{ activeRoles.clear(); }
  save();
}
Array.from(document.querySelectorAll('.preset')).forEach(p=>{
  p.addEventListener('click', ()=>{
    const which = p.dataset.preset;
    setAllRoleButtons(false);
    if(which==="ALL"){ ["UX","UI","Content","Dev"].forEach(r=>toggleRole(r,true,false)); }
    else{ toggleRole(which,true,false); }
    render();
  });
});

// Initial AAA toggle & roles from state
el('#toggleAAA').setAttribute('aria-pressed', (state.showAAA||false)+'');
render();
</script>
</body>
</html>
